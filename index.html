<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MY FAVORITE MUSIC</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #6c5ce7;
        --secondary-color: #a29bfe;
        --dark-color: #2d3436;
        --light-color: #f5f6fa;
        --anime-color: #e84393;
        --tokusatsu-color: #0984e3;
        --international-color: #00b894;
        --local-color: #fdcb6e;
        --danger-color: #d63031;
        --success-color: #00b894;
        --warning-color: #fdcb6e;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background: linear-gradient(135deg, #1e1e2f, #2d3436);
        color: #fff;
        font-family: "Poppins", sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        overflow-x: hidden;
        width: 100%;
        position: relative;
      }

      /* Video Background */
      .video-background-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }

      .video-background-container.active {
        opacity: 1;
      }

      .video-background-container video {
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        object-fit: cover;
        transition: opacity 0.5s ease;
      }

      .video-background-container video.loading {
        opacity: 0;
      }

      .video-background-container video.loaded {
        opacity: 1;
      }

      .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1;
      }

      .video-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 1.2rem;
        z-index: 2;
        background: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        border-radius: 10px;
        display: none;
      }

      .video-loading.active {
        display: block;
      }

      .video-loop-indicator {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        z-index: 3;
        display: none;
      }

      .video-loop-indicator.active {
        display: block;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #1e1e2f, #2d3436);
        z-index: -2;
      }

      body {
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 100%;
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
        width: 100%;
        position: relative;
        z-index: 1;
      }

      .music-container {
        background: rgba(30, 30, 46, 0.8);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        padding: 30px;
        margin: 30px auto;
        width: calc(100% - 30px);
        max-width: 1000px;
        box-sizing: border-box;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .music-container::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(108, 92, 231, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.5s ease;
        z-index: -1;
      }

      .music-container:hover::before {
        opacity: 1;
      }

      .music-container:hover {
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        transform: translateY(-5px);
      }

      .row {
        margin-right: -15px;
        margin-left: -15px;
        display: flex;
        flex-wrap: wrap;
      }

      .col-lg-5,
      .col-lg-7 {
        padding-right: 15px;
        padding-left: 15px;
      }

      .album-cover {
        width: 100%;
        max-width: 350px;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        margin-bottom: 25px;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        aspect-ratio: 1/1;
        object-fit: cover;
        border: 3px solid rgba(255, 255, 255, 0.1);
      }

      .album-cover.playing {
        animation: pulse 2s infinite, glow 3s infinite alternate;
        box-shadow: 0 0 20px rgba(108, 92, 231, 0.6);
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes glow {
        from {
          box-shadow: 0 0 20px rgba(108, 92, 231, 0.6);
        }
        to {
          box-shadow: 0 0 30px rgba(108, 92, 231, 0.9);
        }
      }

      .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 25px 0;
        gap: 15px;
      }

      .controls button {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: #fff;
        font-size: 22px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .controls button:hover {
        background: rgba(108, 92, 231, 0.3);
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
      }

      .controls .play-btn {
        font-size: 28px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        width: 70px;
        height: 70px;
        box-shadow: 0 5px 20px rgba(108, 92, 231, 0.5);
      }

      .controls .play-btn:hover {
        background: linear-gradient(
          135deg,
          var(--secondary-color),
          var(--primary-color)
        );
        transform: translateY(-5px) scale(1.1);
        box-shadow: 0 8px 25px rgba(108, 92, 231, 0.6);
      }

      .progress-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        cursor: pointer;
        margin: 20px 0 10px;
        height: 8px;
        width: 100%;
        transition: height 0.2s ease;
        overflow: hidden;
      }

      .progress-container:hover {
        height: 10px;
      }

      .progress {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 10px;
        height: 100%;
        width: 0%;
        transition: width 0.1s linear;
        position: relative;
      }

      .progress::after {
        content: "";
        position: absolute;
        right: -8px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        background-color: var(--primary-color);
        border-radius: 50%;
        opacity: 0;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px var(--primary-color);
      }

      .progress-container:hover .progress::after {
        opacity: 1;
        right: -10px;
        width: 20px;
        height: 20px;
      }

      .song-list {
        margin-top: 30px;
        max-height: 450px;
        overflow-y: auto;
        scroll-behavior: smooth;
        padding-right: 10px;
      }

      .song-list-container {
        position: relative;
      }

      .song-item {
        padding: 15px 20px;
        background-color: rgba(42, 42, 58, 0.7);
        border-radius: 12px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 4px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .song-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          rgba(108, 92, 231, 0.1),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .song-item:hover {
        background-color: rgba(51, 51, 71, 0.8);
        transform: translateX(5px);
        border-left-color: var(--primary-color);
      }

      .song-item:hover::before {
        transform: translateX(0);
      }

      .song-item.active {
        background: linear-gradient(
          90deg,
          rgba(108, 92, 231, 0.3),
          rgba(42, 42, 58, 0.7)
        );
        border-left-color: var(--primary-color);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
      }

      .song-item.active .artist {
        color: rgba(255, 255, 255, 0.9);
      }

      .song-info {
        flex: 1;
        min-width: 0;
        overflow: hidden;
      }

      .song-info .title {
        font-weight: 600;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 1rem;
      }

      .song-info .artist {
        font-size: 0.85rem;
        color: #bbb;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .time-info {
        display: flex;
        justify-content: space-between;
        color: #bbb;
        font-size: 0.85rem;
        margin-bottom: 10px;
      }

      /* Enhanced Audio Visualization */
      .visualization-container {
        position: relative;
        width: 100%;
        height: 80px;
        margin: 25px 0;
        overflow: hidden;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.2);
      }

      .visualization {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        height: 100%;
        gap: 4px;
        padding: 0 10px;
        position: relative;
      }

      .bar {
        width: 8px;
        border-radius: 4px;
        background: linear-gradient(
          to top,
          var(--primary-color),
          var(--secondary-color)
        );
        transition: height 0.2s ease;
        position: relative;
        box-shadow: 0 0 5px rgba(108, 92, 231, 0.5);
      }

      .bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100%;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        border-radius: 4px;
      }

      .visualization-wave {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          ellipse at center,
          rgba(108, 92, 231, 0.2) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .playing .visualization-wave {
        opacity: 1;
        animation: wavePulse 2s infinite alternate;
      }

      @keyframes wavePulse {
        0% {
          transform: scale(1);
          opacity: 0.5;
        }
        100% {
          transform: scale(1.2);
          opacity: 0.8;
        }
      }

      /* Scrollbar styling */
      .song-list::-webkit-scrollbar {
        width: 10px;
      }

      .song-list::-webkit-scrollbar-track {
        background: rgba(42, 42, 58, 0.5);
        border-radius: 10px;
      }

      .song-list::-webkit-scrollbar-thumb {
        background: linear-gradient(
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 10px;
      }

      .song-list::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-color);
      }

      /* Volume control */
      .volume-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 20px;
      }

      .volume-slider {
        width: 120px;
        cursor: pointer;
        appearance: none;
        -moz-appearance: none;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
        transition: all 0.2s ease;
      }

      .volume-slider:hover {
        height: 8px;
      }

      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .volume-slider::-webkit-slider-thumb:hover {
        background: var(--secondary-color);
        transform: scale(1.2);
      }

      /* Filter buttons */
      .filter-buttons {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 8px 16px;
        border-radius: 25px;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.85rem;
        font-weight: 500;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .filter-btn.active {
        background: var(--primary-color);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
      }

      .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      }

      /* Category filter buttons */
      .category-buttons {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .category-btn {
        padding: 8px 16px;
        border-radius: 25px;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.85rem;
        font-weight: 500;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .category-btn.active[data-category="anime"] {
        background: var(--anime-color);
        box-shadow: 0 5px 15px rgba(232, 67, 147, 0.4);
      }

      .category-btn.active[data-category="tokusatsu"] {
        background: var(--tokusatsu-color);
        box-shadow: 0 5px 15px rgba(9, 132, 227, 0.4);
      }

      .category-btn.active[data-category="international"] {
        background: var(--international-color);
        box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
      }

      .category-btn.active[data-category="local"] {
        background: var(--local-color);
        color: var(--dark-color);
        box-shadow: 0 5px 15px rgba(253, 203, 110, 0.4);
      }

      .category-btn.active[data-category="all"] {
        background: var(--primary-color);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
      }

      .category-btn:hover,
      .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
      }

      .category-btn,
      .filter-btn {
        transform: translateZ(0);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      /* Search box */
      .search-container {
        margin-bottom: 20px;
        position: relative;
      }

      .search-input {
        width: 100%;
        padding: 12px 20px;
        border-radius: 25px;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        padding-right: 45px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .search-input:focus {
        outline: none;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
      }

      .search-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .search-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.7);
        pointer-events: none;
      }

      /* Song counter */
      .song-counter {
        text-align: right;
        font-size: 0.85rem;
        color: #bbb;
        margin-bottom: 15px;
      }

      /* Loading state */
      .loading {
        position: relative;
        overflow: hidden;
      }

      .loading::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Error message */
      .error-message {
        color: var(--danger-color);
        text-align: center;
        margin-top: 15px;
        font-size: 0.9rem;
        display: none;
        padding: 10px;
        background: rgba(214, 48, 49, 0.1);
        border-radius: 5px;
        border-left: 4px solid var(--danger-color);
      }

      /* Category indicators */
      .category-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-left: 8px;
        vertical-align: middle;
      }

      .category-indicator.anime {
        background-color: var(--anime-color);
        box-shadow: 0 0 5px var(--anime-color);
      }

      .category-indicator.tokusatsu {
        background-color: var(--tokusatsu-color);
        box-shadow: 0 0 5px var(--tokusatsu-color);
      }

      .category-indicator.international {
        background-color: var(--international-color);
        box-shadow: 0 0 5px var(--international-color);
      }

      .category-indicator.local {
        background-color: var(--local-color);
        box-shadow: 0 0 5px var(--local-color);
      }

      /* Song duration */
      .duration {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
        margin-left: 10px;
        flex-shrink: 0;
      }

      /* Responsive adjustments */
      @media (max-width: 992px) {
        .music-container {
          padding: 25px;
        }
        .album-cover {
          max-width: 300px;
        }
        .controls {
          margin: 20px 0;
        }
        .controls button {
          width: 45px;
          height: 45px;
          font-size: 20px;
        }
        .controls .play-btn {
          width: 60px;
          height: 60px;
          font-size: 26px;
        }
        .song-list {
          max-height: 400px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
          display: block;
          min-height: auto;
        }
        .music-container {
          margin: 10px 0;
          padding: 20px;
          width: 100%;
          border-radius: 15px;
        }
        .row {
          flex-direction: column;
          margin: 0;
        }
        .col-lg-5,
        .col-lg-7 {
          width: 100%;
          padding: 0;
        }
        .album-cover {
          max-width: 250px;
          margin: 0 auto 20px;
        }
        .controls {
          margin: 20px 0;
          gap: 12px;
        }
        .controls button {
          width: 45px;
          height: 45px;
          font-size: 20px;
        }
        .controls .play-btn {
          width: 60px;
          height: 60px;
          font-size: 26px;
        }
        .song-details {
          margin: 15px 0;
        }
        .song-details h3 {
          font-size: 1.3rem;
        }
        .song-details p {
          font-size: 0.95rem;
        }
        .time-info {
          margin: 15px 0 10px;
        }
        .progress-container {
          margin: 15px 0 10px;
        }
        .visualization-container {
          height: 70px;
          margin: 20px 0;
        }
        .volume-container {
          margin-top: 15px;
        }
        .song-list-container {
          margin-top: 25px;
        }
        .search-container {
          margin-bottom: 15px;
        }
        .filter-buttons,
        .category-buttons {
          gap: 10px;
          margin-bottom: 20px;
        }
        .filter-btn,
        .category-btn {
          padding: 7px 14px;
          font-size: 0.8rem;
        }
        .song-counter {
          margin-bottom: 12px;
        }
        .song-list {
          max-height: 350px;
          margin-top: 20px;
        }
        .song-item {
          padding: 12px 18px;
          margin-bottom: 8px;
        }
        .song-info .title {
          font-size: 0.95rem;
        }
        .song-info .artist {
          font-size: 0.8rem;
        }
        .duration {
          font-size: 0.8rem;
        }
      }

      @media (max-width: 576px) {
        .music-container {
          padding: 18px;
        }
        .album-cover {
          max-width: 220px;
        }
        .controls button {
          width: 42px;
          height: 42px;
          font-size: 18px;
        }
        .controls .play-btn {
          width: 55px;
          height: 55px;
          font-size: 24px;
        }
        .song-list {
          max-height: 300px;
        }
        .search-input {
          padding: 10px 16px;
          font-size: 0.9rem;
        }
        .filter-buttons,
        .category-buttons {
          gap: 8px;
        }
        .filter-btn,
        .category-btn {
          padding: 6px 12px;
          font-size: 0.75rem;
        }
      }

      @media (max-width: 400px) {
        .controls {
          gap: 8px;
        }
        .controls button {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }
        .controls .play-btn {
          width: 50px;
          height: 50px;
          font-size: 22px;
        }
        .song-list {
          max-height: 250px;
        }
      }

      /* Floating animation for the music container */
      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      .music-container {
        animation: float 6s ease-in-out infinite;
      }

      /* Button pulse animation */
      @keyframes pulseBtn {
        0% {
          box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(108, 92, 231, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(108, 92, 231, 0);
        }
      }

      .play-btn.playing {
        animation: pulseBtn 1.5s infinite;
      }

      /* Enhanced animations for song list */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .song-item {
        animation: fadeInUp 0.5s ease forwards;
        opacity: 0;
      }

      .song-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .song-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .song-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .song-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .song-item:nth-child(5) {
        animation-delay: 0.25s;
      }
      .song-item:nth-child(6) {
        animation-delay: 0.3s;
      }
      .song-item:nth-child(7) {
        animation-delay: 0.35s;
      }
      .song-item:nth-child(8) {
        animation-delay: 0.4s;
      }
      .song-item:nth-child(9) {
        animation-delay: 0.45s;
      }
      .song-item:nth-child(10) {
        animation-delay: 0.5s;
      }
      .song-item:nth-child(n + 11) {
        animation-delay: 0.55s;
      }
    </style>
  </head>
  <body>
    <!-- Video Background -->
    <div class="video-background-container">
      <div class="video-loading" id="video-loading">
        <i class="fas fa-spinner fa-spin"></i> Loading video...
      </div>
      <div class="video-loop-indicator" id="video-loop-indicator">
        <i class="fas fa-redo"></i> Looping
      </div>
      <video id="backgroundVideo" muted playsinline></video>
      <div class="video-overlay"></div>
    </div>

    <div class="container">
      <div class="music-container">
        <h1
          class="text-center mb-4"
          style="
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          "
        >
          MY FAVORITE MUSIC
        </h1>
        <div class="row">
          <div class="col-lg-5">
            <div class="d-flex justify-content-center">
              <img
                id="album-cover"
                src="Kenshin.png"
                alt="Album Cover"
                class="album-cover"
              />
            </div>

            <div class="visualization-container">
              <div class="visualization" id="visualization">
                <!-- Bars will be generated by JavaScript -->
              </div>
              <div class="visualization-wave"></div>
            </div>

            <div class="song-details text-center">
              <h3 id="title" style="font-weight: 600; margin-bottom: 5px">
                Samurai X - Creditless
              </h3>
              <p id="artist" style="color: #bbb; font-size: 0.95rem">
                Judy And Mary
              </p>
            </div>

            <div class="time-info">
              <span id="current-time">0:00</span>
              <span id="duration">3:28</span>
            </div>
            <div class="progress-container" id="progress-container">
              <div class="progress" id="progress"></div>
            </div>

            <div class="controls">
              <button id="shuffle" class="action-btn" title="Acak">
                <i class="fas fa-random"></i>
              </button>
              <button id="prev" class="action-btn" title="Sebelumnya">
                <i class="fas fa-step-backward"></i>
              </button>
              <button id="play" class="play-btn" title="Putar">
                <i class="fas fa-play"></i>
              </button>
              <button id="next" class="action-btn" title="Berikutnya">
                <i class="fas fa-step-forward"></i>
              </button>
              <button id="repeat" class="action-btn" title="Ulangi">
                <i class="fas fa-redo"></i>
              </button>
            </div>

            <div class="volume-container">
              <i class="fas fa-volume-down" style="color: #bbb"></i>
              <input
                type="range"
                id="volume"
                class="volume-slider"
                min="0"
                max="1"
                step="0.01"
                value="0.7"
              />
              <i class="fas fa-volume-up" style="color: #bbb"></i>
            </div>

            <div id="error-message" class="error-message"></div>
          </div>

          <div class="col-lg-7">
            <div class="song-list-container">
              <div class="search-container">
                <input
                  type="text"
                  id="search-input"
                  class="search-input"
                  placeholder="Cari lagu atau artis..."
                />
                <i class="fas fa-search search-icon"></i>
              </div>

              <div class="category-buttons">
                <button class="category-btn active" data-category="all">
                  All
                </button>
                <button class="category-btn" data-category="anime">
                  Anime
                </button>
                <button class="category-btn" data-category="tokusatsu">
                  Tokusatsu
                </button>
                <button class="category-btn" data-category="international">
                  International
                </button>
                <button class="category-btn" data-category="local">
                  Local
                </button>
              </div>

              <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="normal">Normal</button>
                <button class="filter-btn" data-filter="speedup">
                  Speed Up
                </button>
                <button class="filter-btn" data-filter="slowed">Slowed</button>
              </div>

              <div class="song-counter" id="song-counter">3 lagu</div>
              <div class="song-list" id="song-list">
                <!-- Songs will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data lagu dengan video background
      const songs = [
        // Anime
        {
          title: "Samurai X",
          artist: "Judy And Mary",
          cover: "Kenshin.png",
          audioPath: "Rurouni Kenshin - Opening 1 _ 4K 60FPS Creditless.mp3",
          videoBgSrc: "Rurouni Kenshin - Opening 1 _ 4K 60FPS Creditless.mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "Saint Seiya - Pegasus Fantasy",
          artist: "-",
          cover: "Saint Seiya (1).png",
          audioPath: "Saint Seiya Opening [4K 60FPS Remastered].mp3",
          videoBgSrc: "youtube_Saint Seiya Opening [4K 60FPS Remastered].mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "Saint Seiya - Soldier Dream",
          artist: "-",
          cover: "Saint Seiya (2).png",
          audioPath: "Saint Seiya Opening 2 (Japanese - 4K).mp3",
          videoBgSrc:
            "youtube_Saint Seiya - Opening 2 (Latino) - [4K - Audio Stereo Remaster] •「Soldier Dream」•.mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "Saint Seiya - Soldier Dream (Soul Of Gold)",
          artist: "-",
          cover: "Saint Seiya (3).png",
          audioPath:
            "Saint Seiya_ Soul of Gold Opening Creditless (4K AI Upscaled & Enhanced).mp3",
          videoBgSrc:
            "youtube_Saint Seiya_ Soul of Gold Opening Creditless (4K AI Upscaled & Enhanced).mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "One Punch Man - Opening 1",
          artist: "-",
          cover: ".png",
          audioPath:
            "「Creditless」One Punch Man OP  Opening 1「UHD 60FPS」.mp3",
          videoBgSrc:
            "aifaceswap-「Creditless」One Punch Man OP _ Opening 1「UHD 60FPS」.mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "One Punch Man - Opening 2",
          artist: "-",
          cover: ".png",
          audioPath: "One Punch Man Opening 2 4K 60FPS Creditless.mp3",
          videoBgSrc:
            "aifaceswap-One Punch Man Opening 2 _ 4K _ 60FPS _ Creditless _.mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "Dragon Raja",
          artist: "Tencent",
          cover: "DragonRaja.jpg",
          audioPath: "DragonRaja.mp3",
          videoBgSrc:
            "【Dragon Raja】New Class PV Reveal - Performer Joins the Battle! (1080P).mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        {
          title: "Kaiju No. 8 - Invincible",
          artist: "One Republic",
          cover: "Invi.png",
          audioPath:
            "OneRepublic - Invincible (from Kaiju No. 8)[Official Music Video].mp3",
          videoBgSrc:
            "youtube_アニメ『怪獣８号』ノンクレジットED｜OneRepublic「Nobody」｜毎週土曜23時～放送・配信.mp4",
          duration: "3:28",
          type: "normal",
          category: "anime",
        },
        // TOKUSATSU - ULTRAMAN / KAMEN RIDER
        {
          title: "Kamen Rider Stronger - Tackle Song",
          artist: "Bandai",
          cover: "TACKLE.jpg",
          audioPath: "Kamen Rider Tackle (1975).mp3",
          videoBgSrc: "Kamen Rider Tackle (1975).mp4",
          duration: "7:49",
          type: "normal",
          category: "tokusatsu",
        },
        // LOCAL
        {
          title: "Bunga Terakhir",
          artist: "Bebi Romeo",
          cover: "BUNGA (2).png",
          audioPath: "original-sound-kieruahahah.mp3",
          videoBgSrc: "again-lookbackedit-sad-bungaterakhir-kyomoto-fujino.mp4",
          duration: "3:12",
          type: "normal",
          category: "local",
        },
        {
          title: "Bunga Terakhir Ver.2",
          artist: "Bebi Romeo",
          cover: "BUNGA (1).png",
          audioPath: "original-sound-ayzegio.mp3",
          videoBgSrc:
            "malas-post🥀-takopiinogenzai-x-bunga-terakhir-animeedit-lagugalau-sadanime-fypシ-amv.mp4",
          duration: "3:12",
          type: "normal",
          category: "local",
        },
        // ... (data lagu lainnya sesuai kebutuhan)
      ];

      // Mengambil elemen DOM
      const playBtn = document.getElementById("play");
      const prevBtn = document.getElementById("prev");
      const nextBtn = document.getElementById("next");
      const shuffleBtn = document.getElementById("shuffle");
      const repeatBtn = document.getElementById("repeat");
      const songTitle = document.getElementById("title");
      const artistName = document.getElementById("artist");
      const albumCover = document.getElementById("album-cover");
      const songList = document.getElementById("song-list");
      const progressContainer = document.getElementById("progress-container");
      const progress = document.getElementById("progress");
      const currentTimeEl = document.getElementById("current-time");
      const durationEl = document.getElementById("duration");
      const visualization = document.getElementById("visualization");
      const volumeSlider = document.getElementById("volume");
      const errorMessage = document.getElementById("error-message");
      const searchInput = document.getElementById("search-input");
      const filterButtons = document.querySelectorAll(".filter-btn");
      const categoryButtons = document.querySelectorAll(".category-btn");
      const songCounter = document.getElementById("song-counter");
      const backgroundVideoContainer = document.querySelector(
        ".video-background-container"
      );
      const backgroundVideo = document.getElementById("backgroundVideo");
      const videoLoading = document.getElementById("video-loading");
      const videoLoopIndicator = document.getElementById(
        "video-loop-indicator"
      );

      // Elemen audio
      const audio = new Audio();

      // Audio context untuk visualisasi
      let audioContext;
      let analyser;
      let dataArray;
      let bufferLength;
      let source;
      let animationId;

      // Status musik
      let isPlaying = false;
      let currentSongIndex = 0; // Langsung set ke lagu pertama (Samurai X)
      let isShuffle = false;
      let isRepeat = false;
      let previousVolume = 0.7;
      let isChangingSong = false;
      let isScrolling = false;
      let currentFilter = "all";
      let currentCategory = "all";
      let currentSearchTerm = "";
      let filteredSongs = [...songs];
      let videoSyncInterval;
      let videoLoopInterval;
      let isVideoLooping = false;
      let currentVideoSrc = "";

      // PERBAIKAN UTAMA: Fungsi untuk memuat video background dengan looping
      function loadBackgroundVideo(videoSrc) {
        // Hentikan sinkronisasi dan looping sebelumnya
        clearInterval(videoSyncInterval);
        clearInterval(videoLoopInterval);

        // Reset status looping
        isVideoLooping = false;
        videoLoopIndicator.classList.remove("active");

        // Jika tidak ada video, sembunyikan container
        if (!videoSrc || videoSrc === ".mp4" || videoSrc === "") {
          backgroundVideoContainer.classList.remove("active");
          backgroundVideo.src = "";
          videoLoading.classList.remove("active");
          return;
        }

        // Tampilkan loading indicator
        videoLoading.classList.add("active");
        backgroundVideo.classList.add("loading");
        backgroundVideo.classList.remove("loaded");

        // Set source video dan atur untuk looping
        backgroundVideo.src = videoSrc;
        backgroundVideo.loop = true; // ✅ SET LOOPING DI SINI
        currentVideoSrc = videoSrc;

        // Event listeners untuk video
        backgroundVideo.onloadeddata = function () {
          console.log("Video loaded with looping:", videoSrc);
          backgroundVideo.classList.remove("loading");
          backgroundVideo.classList.add("loaded");
          videoLoading.classList.remove("active");
          backgroundVideoContainer.classList.add("active");

          // Mulai looping video
          startVideoLooping();

          // Sinkronkan dengan audio jika sedang diputar
          if (isPlaying) {
            backgroundVideo.currentTime = audio.currentTime;
            backgroundVideo.play().catch((e) => {
              console.error("Error playing video:", e);
            });
          }
        };

        backgroundVideo.onerror = function () {
          console.error("Error loading video:", videoSrc);
          videoLoading.classList.remove("active");
          backgroundVideoContainer.classList.remove("active");
          showError("Gagal memuat video background");
        };

        backgroundVideo.oncanplaythrough = function () {
          console.log("Video can play through:", videoSrc);
        };
      }

      // PERBAIKAN: Fungsi untuk memulai looping video
      function startVideoLooping() {
        isVideoLooping = true;
        videoLoopIndicator.classList.add("active");

        // Hapus interval sebelumnya
        clearInterval(videoLoopInterval);

        // Cek setiap 500ms apakah video perlu di-loop
        videoLoopInterval = setInterval(() => {
          if (backgroundVideo.src && !backgroundVideo.paused) {
            const currentTime = backgroundVideo.currentTime;
            const duration = backgroundVideo.duration;

            // Jika video hampir selesai (dalam 0.5 detik dari akhir)
            if (duration - currentTime < 0.5) {
              console.log("Video looping back to start");
              backgroundVideo.currentTime = 0;
            }

            // Jika video error atau stalled, coba restart
            if (backgroundVideo.ended && !backgroundVideo.paused) {
              console.log("Video ended, restarting...");
              backgroundVideo.currentTime = 0;
              backgroundVideo.play().catch((e) => {
                console.error("Error restarting video:", e);
              });
            }
          }
        }, 500);
      }

      // PERBAIKAN UTAMA: Fungsi untuk sinkronisasi video dengan audio
      function syncVideoWithAudio() {
        if (!backgroundVideo.src || !isPlaying) return;

        const currentAudioTime = audio.currentTime;
        const currentVideoTime = backgroundVideo.currentTime;
        const videoDuration = backgroundVideo.duration;

        // Jika video duration valid, hitung posisi looping
        if (videoDuration && !isNaN(videoDuration)) {
          const expectedVideoTime = currentAudioTime % videoDuration;

          // Jika perbedaan waktu lebih dari 1 detik, sinkronkan
          if (Math.abs(currentVideoTime - expectedVideoTime) > 1.0) {
            backgroundVideo.currentTime = expectedVideoTime;
          }
        } else {
          // Fallback: sinkronisasi sederhana
          if (Math.abs(currentAudioTime - currentVideoTime) > 0.5) {
            backgroundVideo.currentTime = currentAudioTime;
          }
        }

        // Cek apakah video masih berjalan, jika tidak, coba putar ulang
        if (backgroundVideo.paused && isPlaying) {
          backgroundVideo.play().catch((e) => {
            console.log("Video paused, attempting to restart:", e);
          });
        }

        // Force restart video jika stalled
        if (backgroundVideo.ended && isPlaying) {
          console.log("Video ended, forcing restart");
          backgroundVideo.currentTime = 0;
          backgroundVideo.play().catch((e) => {
            console.error("Error forcing video restart:", e);
          });
        }
      }

      // PERBAIKAN UTAMA: Event listener untuk visibility change
      document.addEventListener("visibilitychange", function () {
        if (document.hidden) {
          // Tab tidak aktif - hentikan sinkronisasi untuk menghemat sumber daya
          clearInterval(videoSyncInterval);
        } else {
          // Tab aktif kembali - mulai sinkronisasi ulang
          if (isPlaying && backgroundVideo.src) {
            // Sinkronkan video dengan audio saat kembali
            backgroundVideo.currentTime = audio.currentTime;
            backgroundVideo.play().catch((e) => {
              console.log("Error resuming video:", e);
            });

            // Mulai sinkronisasi interval
            videoSyncInterval = setInterval(syncVideoWithAudio, 500);
          }
        }
      });

      // PERBAIKAN: Event listener untuk page focus/blur
      window.addEventListener("focus", function () {
        if (isPlaying && backgroundVideo.src) {
          // Tab aktif kembali, sinkronkan video
          backgroundVideo.currentTime = audio.currentTime;
          backgroundVideo.play().catch((e) => {
            console.log("Error resuming video on focus:", e);
          });

          // Mulai sinkronisasi interval
          videoSyncInterval = setInterval(syncVideoWithAudio, 500);
        }
      });

      window.addEventListener("blur", function () {
        // Hentikan sinkronisasi saat tab tidak aktif
        clearInterval(videoSyncInterval);
      });

      // Setup audio visualization
      function setupAudioVisualization() {
        // Create audio context
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        source = audioContext.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioContext.destination);

        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);

        // Create visualization bars
        visualization.innerHTML = "";
        const barCount = Math.floor(visualization.clientWidth / 12);

        for (let i = 0; i < barCount; i++) {
          const bar = document.createElement("div");
          bar.classList.add("bar");
          bar.style.height = "5px";
          visualization.appendChild(bar);
        }
      }

      // Update visualization
      function updateVisualization() {
        if (!analyser || !isPlaying) return;

        analyser.getByteFrequencyData(dataArray);

        const bars = document.querySelectorAll(".bar");
        const barCount = bars.length;

        for (let i = 0; i < barCount; i++) {
          const value = dataArray[i % bufferLength];
          const height = Math.max(5, (value / 255) * 100);
          bars[i].style.height = `${height}%`;
        }

        animationId = requestAnimationFrame(updateVisualization);
      }

      // PERBAIKAN UTAMA: Update background video
      function updateBackgroundVideo(song) {
        // Hanya update video jika ada path yang valid
        if (
          song.videoBgSrc &&
          song.videoBgSrc !== ".mp4" &&
          song.videoBgSrc !== ""
        ) {
          loadBackgroundVideo(song.videoBgSrc);
        } else {
          // Sembunyikan video background
          backgroundVideoContainer.classList.remove("active");
          backgroundVideo.src = "";
          videoLoading.classList.remove("active");
          videoLoopIndicator.classList.remove("active");
          clearInterval(videoLoopInterval);
          isVideoLooping = false;
        }
      }

      // Mengisi daftar lagu
      function populateSongList() {
        songList.innerHTML = "";

        // Filter songs based on current filter, category and search term
        filteredSongs = songs.filter((song) => {
          const matchesFilter =
            currentFilter === "all" || song.type === currentFilter;
          const matchesCategory =
            currentCategory === "all" || song.category === currentCategory;
          const matchesSearch =
            currentSearchTerm === "" ||
            song.title.toLowerCase().includes(currentSearchTerm) ||
            song.artist.toLowerCase().includes(currentSearchTerm);
          return matchesFilter && matchesCategory && matchesSearch;
        });

        // Update song counter
        songCounter.textContent = `${filteredSongs.length} lagu`;

        if (filteredSongs.length === 0) {
          const emptyMessage = document.createElement("div");
          emptyMessage.classList.add("text-center", "py-3");
          emptyMessage.textContent = "Tidak ada lagu yang ditemukan";
          songList.appendChild(emptyMessage);
          return;
        }

        filteredSongs.forEach((song, index) => {
          const originalIndex = songs.findIndex(
            (s) =>
              s.title === song.title &&
              s.artist === song.artist &&
              s.audioPath === song.audioPath
          );

          const songItem = document.createElement("div");
          songItem.classList.add("song-item");
          if (originalIndex === currentSongIndex) {
            songItem.classList.add("active");
          }

          // Add category indicator
          let categoryClass = "";
          if (song.category === "anime") categoryClass = "anime";
          else if (song.category === "tokusatsu") categoryClass = "tokusatsu";
          else if (song.category === "international")
            categoryClass = "international";
          else if (song.category === "local") categoryClass = "local";

          songItem.innerHTML = `
                    <div class="song-info">
                        <div class="title">${song.title} <span class="category-indicator ${categoryClass}"></span></div>
                        <div class="artist">${song.artist}</div>
                    </div>
                    <div class="duration">${song.duration}</div>
                `;

          songItem.addEventListener("click", () => {
            if (isChangingSong || isScrolling) return;
            isChangingSong = true;

            // Find the original index of the clicked song
            currentSongIndex = songs.findIndex(
              (s) =>
                s.title === song.title &&
                s.artist === song.artist &&
                s.audioPath === song.audioPath
            );

            // Hapus kelas aktif dari semua item
            document.querySelectorAll(".song-item").forEach((item) => {
              item.classList.remove("active");
            });

            // Tambahkan kelas aktif ke item yang diklik
            songItem.classList.add("active");

            loadSong(songs[currentSongIndex]);
            playSong();
            scrollToCurrentSong();

            // Reset flag setelah animasi selesai
            setTimeout(() => {
              isChangingSong = false;
            }, 300);
          });

          songList.appendChild(songItem);
        });
      }

      // Format waktu dari detik ke menit:detik
      function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";

        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
      }

      // Update progress bar
      function updateProgress() {
        const { duration, currentTime } = audio;
        if (isNaN(duration)) return;

        const progressPercent = (currentTime / duration) * 100;
        progress.style.width = `${progressPercent}%`;

        currentTimeEl.textContent = formatTime(currentTime);
      }

      // Set progress bar ketika diklik
      function setProgress(e) {
        const width = this.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;

        if (isNaN(duration)) return;

        const newTime = (clickX / width) * duration;
        audio.currentTime = newTime;

        // Video background juga ikut lompat ke waktu yang sama
        if (backgroundVideo.src && backgroundVideo.duration) {
          backgroundVideo.currentTime = newTime;
        }
      }

      // PERBAIKAN UTAMA: Muat lagu tanpa memutar video
      function loadSong(song) {
        showLoadingState(true);
        hideError();

        songTitle.textContent = song.title;
        artistName.textContent = song.artist;
        albumCover.src = song.cover;
        audio.src = song.audioPath;

        // Hentikan looping sebelumnya
        clearInterval(videoLoopInterval);
        isVideoLooping = false;
        videoLoopIndicator.classList.remove("active");

        // PERBAIKAN: Hanya update UI, jangan langsung load video
        // Video akan diload saat playSong() dipanggil
        if (isPlaying) {
          updateBackgroundVideo(song);
        } else {
          // Jika tidak sedang playing, sembunyikan video
          backgroundVideoContainer.classList.remove("active");
          backgroundVideo.src = "";
        }

        // Set durasi default dari metadata lagu
        durationEl.textContent = song.duration;
      }

      // Putar lagu
      function playSong() {
        isPlaying = true;
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        playBtn.setAttribute("title", "Jeda");
        playBtn.classList.add("playing");
        albumCover.classList.add("playing");

        // Setup audio visualization if not already done
        if (!audioContext) {
          setupAudioVisualization();
        }

        // Resume audio context if suspended
        if (audioContext.state === "suspended") {
          audioContext.resume();
        }

        // Start visualization
        updateVisualization();

        // PERBAIKAN: Pastikan video background dimuat dan diputar
        const currentSong = songs[currentSongIndex];
        if (
          currentSong.videoBgSrc &&
          currentSong.videoBgSrc !== ".mp4" &&
          currentSong.videoBgSrc !== ""
        ) {
          updateBackgroundVideo(currentSong);
        }

        // Putar video background jika ada
        if (backgroundVideo.src) {
          // Pastikan video mulai dari waktu yang sama dengan audio
          backgroundVideo.currentTime = audio.currentTime;

          // Mulai looping jika belum
          if (!isVideoLooping) {
            startVideoLooping();
          }

          backgroundVideo.play().catch((e) => {
            console.error("Error playing background video:", e);
          });

          // Mulai sinkronisasi interval
          videoSyncInterval = setInterval(syncVideoWithAudio, 500);
        }

        audio
          .play()
          .then(() => {
            showLoadingState(false);
          })
          .catch((e) => {
            console.error("Error playing audio:", e);
            showError("Gagal memutar lagu. Pastikan file audio tersedia.");
            pauseSong();
          });
      }

      // Pause lagu
      function pauseSong() {
        isPlaying = false;
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        playBtn.setAttribute("title", "Putar");
        playBtn.classList.remove("playing");
        albumCover.classList.remove("playing");
        showLoadingState(false);

        // Stop visualization
        cancelAnimationFrame(animationId);

        // Pause video background
        if (backgroundVideo.src) {
          backgroundVideo.pause();
        }

        // Hentikan sinkronisasi dan looping
        clearInterval(videoSyncInterval);
        clearInterval(videoLoopInterval);
        isVideoLooping = false;
        videoLoopIndicator.classList.remove("active");

        audio.pause();
      }

      // Lagu selanjutnya
      function nextSong() {
        if (isChangingSong || filteredSongs.length === 0) return;
        isChangingSong = true;

        // Hapus kelas aktif dari semua item
        document.querySelectorAll(".song-item").forEach((item) => {
          item.classList.remove("active");
        });

        if (isShuffle) {
          // Dapatkan indeks acak dari filteredSongs
          const randomFilteredIndex = Math.floor(
            Math.random() * filteredSongs.length
          );
          const randomSong = filteredSongs[randomFilteredIndex];

          // Cari indeks asli di songs array
          currentSongIndex = songs.findIndex(
            (song) =>
              song.title === randomSong.title &&
              song.artist === randomSong.artist &&
              song.audioPath === randomSong.audioPath
          );
        } else {
          // Cari lagu berikutnya dalam filteredSongs
          const currentFilteredIndex = filteredSongs.findIndex(
            (song) =>
              song.title === songs[currentSongIndex].title &&
              song.artist === songs[currentSongIndex].artist &&
              song.audioPath === songs[currentSongIndex].audioPath
          );

          const nextFilteredIndex =
            (currentFilteredIndex + 1) % filteredSongs.length;
          const nextSong = filteredSongs[nextFilteredIndex];

          // Cari indeks asli di songs array
          currentSongIndex = songs.findIndex(
            (song) =>
              song.title === nextSong.title &&
              song.artist === nextSong.artist &&
              song.audioPath === nextSong.audioPath
          );
        }

        loadSong(songs[currentSongIndex]);

        // Tambahkan kelas aktif ke item yang sesuai
        const songItems = document.querySelectorAll(".song-item");
        const activeIndex = [...filteredSongs].findIndex(
          (song) =>
            song.title === songs[currentSongIndex].title &&
            song.artist === songs[currentSongIndex].artist &&
            song.audioPath === songs[currentSongIndex].audioPath
        );

        if (songItems[activeIndex]) {
          songItems[activeIndex].classList.add("active");
        }

        if (isPlaying) {
          playSong();
        }

        scrollToCurrentSong();

        setTimeout(() => {
          isChangingSong = false;
        }, 300);
      }

      // Lagu sebelumnya
      function prevSong() {
        if (audio.currentTime > 3) {
          audio.currentTime = 0;
          // Video juga reset ke awal
          if (backgroundVideo.src) {
            backgroundVideo.currentTime = 0;
          }
          return;
        }

        if (isChangingSong || filteredSongs.length === 0) return;
        isChangingSong = true;

        document.querySelectorAll(".song-item").forEach((item) => {
          item.classList.remove("active");
        });

        if (isShuffle) {
          // Sama seperti nextSong
          const randomFilteredIndex = Math.floor(
            Math.random() * filteredSongs.length
          );
          const randomSong = filteredSongs[randomFilteredIndex];

          currentSongIndex = songs.findIndex(
            (song) =>
              song.title === randomSong.title &&
              song.artist === randomSong.artist &&
              song.audioPath === randomSong.audioPath
          );
        } else {
          // Cari lagu sebelumnya dalam filteredSongs
          const currentFilteredIndex = filteredSongs.findIndex(
            (song) =>
              song.title === songs[currentSongIndex].title &&
              song.artist === songs[currentSongIndex].artist &&
              song.audioPath === songs[currentSongIndex].audioPath
          );

          const prevFilteredIndex =
            (currentFilteredIndex - 1 + filteredSongs.length) %
            filteredSongs.length;
          const prevSong = filteredSongs[prevFilteredIndex];

          currentSongIndex = songs.findIndex(
            (song) =>
              song.title === prevSong.title &&
              song.artist === prevSong.artist &&
              song.audioPath === prevSong.audioPath
          );
        }

        loadSong(songs[currentSongIndex]);

        const songItems = document.querySelectorAll(".song-item");
        const activeIndex = [...filteredSongs].findIndex(
          (song) =>
            song.title === songs[currentSongIndex].title &&
            song.artist === songs[currentSongIndex].artist &&
            song.audioPath === songs[currentSongIndex].audioPath
        );

        if (songItems[activeIndex]) {
          songItems[activeIndex].classList.add("active");
        }

        if (isPlaying) {
          playSong();
        }

        scrollToCurrentSong();

        setTimeout(() => {
          isChangingSong = false;
        }, 300);
      }

      // Scroll ke lagu yang sedang aktif
      function scrollToCurrentSong() {
        const songItems = document.querySelectorAll(".song-item");
        const currentSong = songs[currentSongIndex];

        // Find the index in filtered songs
        const filteredIndex = filteredSongs.findIndex(
          (song) =>
            song.title === currentSong.title &&
            song.artist === currentSong.artist &&
            song.audioPath === currentSong.audioPath
        );

        if (songItems[filteredIndex]) {
          isScrolling = true;
          songItems[filteredIndex].scrollIntoView({
            behavior: "smooth",
            block: "nearest",
          });

          // Set timeout untuk reset flag scrolling
          setTimeout(() => {
            isScrolling = false;
          }, 500);
        }
      }

      // Toggle shuffle
      function toggleShuffle() {
        isShuffle = !isShuffle;
        shuffleBtn.style.color = isShuffle ? "var(--primary-color)" : "#fff";

        // Jika shuffle diaktifkan dan ada lagu yang difilter, langsung putar lagu acak dari yang difilter
        if (isShuffle && filteredSongs.length > 0) {
          const randomFilteredIndex = Math.floor(
            Math.random() * filteredSongs.length
          );
          const randomSong = filteredSongs[randomFilteredIndex];

          // Cari indeks asli di songs array
          currentSongIndex = songs.findIndex(
            (song) =>
              song.title === randomSong.title &&
              song.artist === randomSong.artist &&
              song.audioPath === randomSong.audioPath
          );

          loadSong(songs[currentSongIndex]);
          if (isPlaying) {
            playSong();
          }
          populateSongList(); // Update UI untuk menandai lagu aktif
        }
      }

      // Toggle repeat
      function toggleRepeat() {
        isRepeat = !isRepeat;
        repeatBtn.style.color = isRepeat ? "var(--primary-color)" : "#fff";
        audio.loop = isRepeat;
      }

      // Toggle mute/unmute
      function toggleMute() {
        if (audio.volume > 0) {
          previousVolume = audio.volume;
          audio.volume = 0;
          volumeSlider.value = 0;
        } else {
          audio.volume = previousVolume;
          volumeSlider.value = previousVolume;
        }
      }

      // Tampilkan loading state
      function showLoadingState(show) {
        if (show) {
          albumCover.classList.add("loading");
        } else {
          albumCover.classList.remove("loading");
        }
      }

      // Tampilkan pesan error
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
      }

      // Sembunyikan pesan error
      function hideError() {
        errorMessage.style.display = "none";
      }

      // Event listeners untuk video ended (fallback)
      backgroundVideo.addEventListener("ended", function () {
        if (isPlaying) {
          console.log("Video ended event triggered, restarting...");
          this.currentTime = 0;
          this.play().catch((e) => {
            console.error("Error on video ended:", e);
          });
        }
      });

      // Event listener untuk video error
      backgroundVideo.addEventListener("error", function () {
        console.error("Video error occurred, attempting recovery...");
        // Coba reload video setelah 2 detik
        setTimeout(() => {
          if (backgroundVideo.src && isPlaying) {
            backgroundVideo.load();
            backgroundVideo.play().catch((e) => {
              console.error("Video recovery failed:", e);
            });
          }
        }, 2000);
      });

      // Event listeners
      playBtn.addEventListener("click", () => {
        if (isPlaying) {
          pauseSong();
        } else {
          playSong();
        }
      });

      nextBtn.addEventListener("click", nextSong);
      prevBtn.addEventListener("click", prevSong);
      shuffleBtn.addEventListener("click", toggleShuffle);
      repeatBtn.addEventListener("click", toggleRepeat);

      // Ketika lagu berakhir
      audio.addEventListener("ended", () => {
        if (!isRepeat) {
          nextSong();
        } else {
          audio.currentTime = 0;
          // Video juga reset ke awal
          if (backgroundVideo.src) {
            backgroundVideo.currentTime = 0;
          }
          audio.play();
        }
      });

      // Update progress bar
      audio.addEventListener("timeupdate", updateProgress);

      // Klik pada progress bar
      progressContainer.addEventListener("click", setProgress);

      // Ketika metadata audio dimuat (untuk mendapatkan durasi)
      audio.addEventListener("loadedmetadata", () => {
        durationEl.textContent = formatTime(audio.duration);
        showLoadingState(false);
      });

      // Error handling
      audio.addEventListener("error", () => {
        showError("Gagal memuat lagu. Pastikan file audio tersedia.");
        showLoadingState(false);
      });

      // Volume control
      volumeSlider.addEventListener("input", (e) => {
        audio.volume = e.target.value;
        previousVolume = e.target.value;
      });

      // Search functionality
      searchInput.addEventListener("input", (e) => {
        currentSearchTerm = e.target.value.toLowerCase();
        populateSongList();
      });

      // Filter buttons (type)
      filterButtons.forEach((button) => {
        button.addEventListener("click", () => {
          filterButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          currentFilter = button.dataset.filter;
          populateSongList();
        });
      });

      // Category buttons
      categoryButtons.forEach((button) => {
        button.addEventListener("click", () => {
          categoryButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          currentCategory = button.dataset.category;
          populateSongList();
        });
      });

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        switch (e.code) {
          case "Space":
            e.preventDefault();
            if (isPlaying) {
              pauseSong();
            } else {
              playSong();
            }
            break;
          case "ArrowRight":
            audio.currentTime += 5;
            // Video juga maju 5 detik
            if (backgroundVideo.src) {
              backgroundVideo.currentTime += 5;
            }
            break;
          case "ArrowLeft":
            audio.currentTime -= 5;
            // Video juga mundur 5 detik
            if (backgroundVideo.src) {
              backgroundVideo.currentTime -= 5;
            }
            break;
          case "ArrowUp":
            audio.volume = Math.min(audio.volume + 0.1, 1);
            volumeSlider.value = audio.volume;
            break;
          case "ArrowDown":
            audio.volume = Math.max(audio.volume - 0.1, 0);
            volumeSlider.value = audio.volume;
            break;
          case "KeyM":
            toggleMute();
            break;
        }
      });

      // PERBAIKAN UTAMA: Inisialisasi - langsung tampilkan lagu pertama
      function initializeApp() {
        populateSongList();

        // Langsung load lagu pertama (Samurai X)
        loadSong(songs[currentSongIndex]);

        // Setup volume
        audio.volume = volumeSlider.value;

        // Reset status
        isPlaying = false;
      }

      // Jalankan inisialisasi
      initializeApp();
    </script>
  </body>
</html>
